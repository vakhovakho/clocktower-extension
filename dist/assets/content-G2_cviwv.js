const y="LOAD_STYLES",h="UNLOAD_STYLES",v={childList:!0,subtree:!0},d=new MutationObserver(e=>{for(let t=0;t<e.length;t++){let n=e[t].target.classList;if(n.contains("channel")||n.contains("list")){let o=document.querySelectorAll("#whispers li.video.storyteller .name");for(let r=0;r<o.length;r++){let l=o[r].querySelector("video"),i=o[r].innerText;l&&i&&(b(i.trim()),p(i,l))}break}}});function m(){let e=setInterval(()=>{const t=document.getElementById("channels");t&&(d.observe(t,v),clearInterval(e))},2e3)}function f(){d.disconnect()}function S(e,t){var o,r;console.log("moveSTVideoFromWhisper",e);let n=document.querySelectorAll("ul.storytellers li.storyteller");for(let l=0;l<n.length;l++){let i=(o=n[l].querySelector("div.name span"))==null?void 0:o.innerText;if(e.startsWith(i)){let s=document.createElement("video");s.autoplay=!0,s.playsInline=!0,s.disablePictureInPicture=!0,s.disableRemotePlayback=!0,s.srcObject=t.srcObject;let c=document.createElement("div");c.classList.add("video"),c.appendChild(s);let a=n[l].querySelector(".chat");a&&((r=a.querySelector(".video"))==null||r.remove(),a.appendChild(c));break}}}function p(e,t){setTimeout(S,200,e,t)}function b(e){var n;let t=document.querySelectorAll("ul.storytellers .storyteller");for(let o=0;o<t.length;o++)o===e&&((n=t[o].querySelector(".video"))==null||n.remove())}async function u(){return fetch("https://raw.githubusercontent.com/vakhovakho/clocktower-online-georgia-public/main/custom-css.css").then(e=>e.text()).then(e=>{let t=document.getElementById("mastermind-style");t&&t.remove();var n=document.createElement("style");n.id="mastermind-style",n.type="text/css",n.innerHTML=e,document.head.appendChild(n)})}chrome.storage.local.get(["styleLoaded"]).then(async e=>{if(e.styleLoaded===1)try{await u(),m()}catch(t){console.error(t)}});chrome.runtime.onMessage.addListener(function(e,t,n){if(e.action===y&&(u(),m()),e.action===h){let o=document.getElementById("mastermind-style");o&&o.remove(),f()}});
