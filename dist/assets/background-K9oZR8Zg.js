const l="https://api.clocktower.ge/v1/";chrome.storage.local.get(["translate"]).then(e=>{console.log("translate is "+e.translate),r(e.translate?"ka":"en")});chrome.runtime.onMessage.addListener(async function(e){e.translate!=null&&r(e.translate?"ka":"en")});async function i(e,t){return fetch(`${l}roles/${t}/${e}`).then(o=>o.json())}function u(e){a(function(t){localStorage.setItem("roles",JSON.stringify(t))},function(){console.log("Roles have been saved to local storage.")},[e])}function r(e){a(async function(){return JSON.parse(localStorage.getItem("edition")).edition},async function(t){if(t.id==="homebrew")try{const o=await i(t.name,e);u(o),console.log("Roles have been stored in the database.")}catch(o){console.log(o)}d(e),a(()=>window.location.reload())})}function d(e){e==="ka"?chrome.declarativeNetRequest.updateStaticRules({rulesetId:"ruleset_1",enableRuleIds:[1]}):chrome.declarativeNetRequest.updateStaticRules({rulesetId:"ruleset_1",disableRuleIds:[1]})}function a(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return console.log("executing script"),chrome.tabs.query({active:!0,currentWindow:!0},function(c){const n=c[0];console.log(n),n&&(n.url.includes("botc.app")?chrome.scripting.executeScript({target:{tabId:n.id},function:e,args:o},function(s){console.log(s),t&&t(s[0].result)}):console.log("You must be on the Blood on the Clocktower website to use this extension."))})}
